<link rel="stylesheet" href="docs.css" />

<h1>Documentation for <code>/api/user</code></h1>
<p>This section of the API encompasses all user and session functions.</p>

<h2>Prerequisite knowledge</h2>
<h3 id="authorization">Authorization</h3>
<p>
  Authorization is based on cookies, which are automatically sent with the request. There are two
  cookies which are used to verify the authenticity of the request:
</p>
<p>
  <code>session_token</code> - Contains a session token (generated by
  <code class="plain"><a href="#session--create">/session/create</a></code> ). Must be the token of
  the user being manipulated, <b>or</b> a token of an admin-level user.
</p>
<p><code>user_id</code> - Contains the user ID linked to the session token.</p>
<p>
  If the token is invalid or expired, the API will automatically respond with
  <code class="subtle">401: Unauthorized</code>. If the user ID does not match the token record, or
  is not of admin-level, the API will respond with <code class="subtle">403: Forbidden</code>.
</p>
<p>Methods that require authorization will be marked with a star (<span class="auth"></span>).</p>

<h3 id="required-fields">Required fields:</h3>
<p>
  These are the fields that each user is required to have when using
  <code class="plain"><a href="#create">/create</a></code> or
  <code class="plain"><a href="#update-whole">/update-whole</a></code> .
</p>
<p><code>title</code> - Title, such as <i>Mr.</i>, <i>Ms.</i>, etc.</p>
<p><code>firstName</code> - First name.</p>
<p><code>lastName</code> - Last name.</p>
<p>
  <code>dob</code> - Date of birth, formatted as an ISO string (or similar), such as
  <code class="subtle">2024-05-13T18:39:08.492Z</code>.
</p>
<p>
  <code>sex</code> - Legal sex, where <code class="subtle">0 = MALE</code>,
  <code class="subtle">1 = FEMALE</code>, and <code class="subtle">2 = OTHER</code>.
</p>
<p><code>email</code> - Email address.</p>
<p id="required-fields--password">
  <code>password</code> - The password for the account. This should not be sent as plaintext, but
  SHA-256 hashed. Whenever using functions like
  <code class="plain"><a href="#password--check">/password/check</a></code> or
  <code class="plain"><a href="#session--create">/session/create</a></code> , ensure you use the
  hashed version of the password also. An example of how to hash a string in JavaScript would be the
  following:
</p>

<pre><code>const crypto = require("crypto");

let plaintext = "crabcake"
let hashtext = crypto.createHash("sha-256").update(plaintext).digest("hex");
</code></pre>
<p><code>phone</code> - Phone number.</p>
<p>
  <code>isAdmin</code> - A boolean (<code class="subtle">true</code> or
  <code class="subtle">false</code>), determining if the user is an administrator or not.
</p>
<h4>Submitting objects</h4>
<p>
  Any API endpoint that takes an object (e.g. a user object with all required fields) or an array
  will accept it in the same way as other APIs in this list - via query string. For that reason,
  objects must be converted to query strings when the API is queried.
</p>
<p>
  The order of the fields in the string typically does not matter, only that they are present. The
  only time this is not the case is if you are submitting an array of values where the order is
  important (for instance, <code class="subtle">height=175&height=180</code>).
</p>
<p>
  This process should also convert any special characters (like <code class="subtle">@</code>) to
  their URL-encoded variants (<code class="subtle">%40</code>).
</p>
<details>
  <summary>Example of conversion to querystring</summary>
  <pre><code>const querystring = require("querystring");

const obj = {
    name: "Mark",
    funnyData: ["hardy", "har"],                <span class="comment">//arrays are correctly handled ‚úîÔ∏è </span>
    dog: { name: "Marcy", breed: "Labrador" },  <span class="comment">//embedded objects do NOT work (collapsed to empty string) ‚ùå </span>
    signupDate: new Date().toISOString(),       <span class="comment">//dates have to be converted to an ISO string üü° </span>
};
    
let result = querystring.stringify(obj);
console.log(result);
<span class="comment">// name=Mark&funnyData=hardy&funnyData=har&dog=&signupDate=2024-05-13T23%3A43%3A03.694Z</span>
</code></pre>
</details>

<h2>User functions</h2>
<h3 id="create"><code>/create</code> - Create a new user</h3>
<p>This is a <code class="subtle">POST</code> method.</p>
<h4>Parameters:</h4>
<p>All values from <a href="#required-fields">required fields</a>, plus any additional values.</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - JSON data, where <code class="subtle">id</code> is the ID of
  the newly created user.
</p>
<h4>Examples:</h4>
<details>
  <summary>Creating a new user</summary>
  <pre><code>http://localhost:8080/api/users/create?title=mr&firstName=Mark&lastName=Finch&dob=2000-12-15&sex=0&email=mark%40em.co&phone=077584475523&isAdmin=false&password=b662ae3abc798cf627f31727cf1ea4e0a709f531b49cdfa8a07ac473e2cc91ba</code></pre>
</details>

<h3 id="get-whole" class="auth"><code>/get-whole</code> - Get a whole user</h3>
<p>This is a <code class="subtle">GET</code> method.</p>
<h4>Parameters:</h4>
<p><code>iden</code> - The identifier for the user, typically their ID.</p>
<p>
  <code>idenForm</code> - <i>(optional - default <code class="subtle">id</code>)</i> The form of the
  identifier. Valid values are: <code class="subtle">id</code>, <code class="subtle">email</code>.
  ID is the preferred and default option, since it is guaranteed to be unique per user.
</p>
<h4>Return values:</h4>
<p><code class="subtle">200: OK</code> - JSON data containing the entire user (except password).</p>
<p><code class="subtle">404: NOT FOUND</code> - The identifier did not match any users.</p>
<h4>Examples:</h4>
<details>
  <summary>Getting a whole user</summary>
  <pre><code>http://localhost:8080/api/users/get-whole?iden=5356772</code></pre>
</details>
<details>
  <summary>Getting a whole user via email</summary>
  <pre><code>http://localhost:8080/api/users/get-whole?iden=mark%40em.co&idenForm=email</code></pre>
</details>

<h3 id="update-whole" class="auth"><code>/update-whole</code> - Update/replace a whole user</h3>
<p>This is a <code class="subtle">PUT</code> method.</p>
<p class="message warn">
  This method is <b>not recommended</b>, as it is a brute-force method of replacing an entire user
  object in the database. For changing data, use the data methods below.
</p>
<p class="message note">
  When this method is used, any password data in the query will <b>not</b> be accepted, and instead
  the existing password data for that account will remain.
</p>
<h4>Parameters:</h4>
<p>
  All values from <a href="#required-fields">required fields</a>, including
  <code class="subtle">_id</code>, plus any additional values.
</p>
<h4>Return values:</h4>
<p><code class="subtle">200: OK</code> - Message: <code class="subtle">"User updated"</code></p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">_id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Updating an existing user wholly</summary>
  <pre><code>http://localhost:8080/api/users/update-whole?_id=5356772&title=mr&firstName=Markus&lastName=Finchley&dob=2000-12-15&sex=0&email=marko%40em.co&password=doesntmatter&phone=077584475523&isAdmin=false</code></pre>
</details>

<h3 id="add-data" class="auth"><code>/add-data</code> - Add data to a user</h3>
<p>This is a <code class="subtle">PUT</code> method.</p>
<h4>Parameters:</h4>
<p><code>id</code> - The ID for the user.</p>
<p>
  <code>fieldName</code> - The field name to insert data into, such as
  <code class="subtle">fees</code>.
</p>
<p>
  <code>data</code> - The data to insert into the field, either as a single value or an array of
  values.
</p>
<p>
  <code>intoArray</code> - <i>(optional - default <code class="subtle">false</code>)</i> Whether the
  field should contain an array of data (<code class="subtle">true</code>), or a single value (<code
    class="subtle"
    >false</code
  >).
</p>
<p>
  <code>replace</code> - <i>(optional - default <code class="subtle">true</code>)</i> Whether the
  provided data should replace the existing data (<code class="subtle">true</code>), or instead be
  added to the end (<code class="subtle">false</code>).
</p>
<p class="message warn">
  <code>intoArray</code> and <code>replace</code> cannot both be <code class="subtle">false</code>,
  as there would be no way to append to a singular value. It must replace the singular value, or be
  allowed to be come an array.
</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - Message: <code class="subtle">"Data added/replaced"</code>
</p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Adding <code class="subtle">"flavor=vanilla"</code> to a user</summary>
  <pre><code>http://localhost:8080/api/users/add-data?id=5356772&fieldName=flavor&data=vanilla</code></pre>
</details>
<details>
  <summary>Replacing flavor with <code class="subtle">"chocolate"</code></summary>
  <pre><code>http://localhost:8080/api/users/add-data?id=5356772&fieldName=flavor&data=chocolate</code></pre>
  or
  <pre><code>http://localhost:8080/api/users/add-data?id=5356772&fieldName=flavor&data=chocolate&intoArray=false&replace=true</code></pre>
</details>
<details>
  <summary>
    Converting flavor into an array and adding <code class="subtle">"strawberry"</code>
  </summary>
  <pre><code>http://localhost:8080/api/users/add-data?id=5356772&fieldName=flavor&data=strawberry&intoArray=true&replace=false</code></pre>
</details>

<h3 id="get-data" class="auth"><code>/get-data</code> - Get a piece of data from a user</h3>
<p>This is a <code class="subtle">GET</code> method.</p>
<h4>Parameters:</h4>
<p><code>iden</code> - The identifier for the user, typically their ID.</p>
<p>
  <code>fieldNames</code> - A single string, or an array of strings, containing the name of the
  field(s) you want to retrieve the data from.
</p>
<p>
  <code>idenForm</code> - <i>(optional - default <code class="subtle">id</code>)</i> The form of the
  identifier. Valid values are: <code class="subtle">id</code>, <code class="subtle">email</code>.
  ID is the preferred and default option, since it is guaranteed to be unique per user.
</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - JSON data containing the data from the requested fields.<br />
  If the return value is <code class="subtle">{}</code> (null), the field requested does not exist,
  or the provided identifier did not match any users.
</p>
<p>
  <code class="subtle">418: I'M A TEAPOT</code> (wrong method for this action) - Attempting to get
  the password field will result in this error. The password is encrypted and will be of no use
  requested in this way. <br />
  To check password validity, use
  <code class="plain"><a href="#password--check">/password/check</a></code> .
</p>
<h4>Examples:</h4>
<details>
  <summary>Getting the value of field <code class="subtle">flavor</code></summary>
  <pre><code>http://localhost:8080/api/users/get-data?iden=5356772&fieldName=flavor</code></pre>
</details>
<details>
  <summary>
    Getting the value of fields <code class="subtle">dog</code> and <code class="subtle">cat</code>
  </summary>
  <pre><code>http://localhost:8080/api/users/get-data?iden=marko%40em.co&idenForm=email&fieldName=dog&fieldName=cat</code></pre>
</details>

<h3 id="remove-data" class="auth">
  <code>/remove-data</code> - Remove a data field (along with the data) from a user
</h3>
<p>This is a <code class="subtle">DELETE</code> method.</p>
<h4>Parameters:</h4>
<p><code>id</code> - The ID for the user.</p>
<p><code>fieldName</code> - The field name to remove.</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - Message:
  <code class="subtle">"Field [field] removed from user [ID]"</code>
</p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users, or the <code class="subtle">fieldName</code> did not exist on the user.
</p>
<h4>Examples:</h4>
<details>
  <summary>Removing the field <code class="subtle">flavor</code> from a user</summary>
  <pre><code>http://localhost:8080/api/users/remove-data?id=5356772&fieldName=flavor</code></pre>
</details>

<h3 id="destroy" class="auth"><code>/destroy</code> - Destroy a user record</h3>
<p>This is a <code class="subtle">DELETE</code> method.</p>
<p class="message warn">
  <b>This action is irreversible</b> - it should only be called if a user wishes to delete their
  account permanently.
</p>
<h4>Parameters:</h4>
<p><code>id</code> - The ID for the user.</p>
<h4>Return values:</h4>
<p><code class="subtle">200: OK</code> - Message: <code class="subtle">"User destroyed"</code></p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Destroying user with ID <code class="subtle">5356772</code></summary>
  <pre><code>http://localhost:8080/api/users/destroy?id=5356772</code></pre>
</details>

<h2>Password functions</h2>
<h3 id="password--check" class="auth"><code>/password/check</code> - Check a user's password</h3>
<p>This is a <code class="subtle">GET</code> method.</p>
<h4>Parameters:</h4>
<p><code>id</code> - The ID for the user.</p>
<p>
  <code>password</code> - The password to check against the user's record. Should be
  <a href="#required-fields--password">SHA-256 hashed</a>
  before being put into the query.
</p>
<h4>Return values:</h4>
<p><code class="subtle">200: OK</code> - Message: <code class="subtle">"Password match"</code></p>
<p>
  <code class="subtle">403: FORBIDDEN</code> - The submitted
  <code class="subtle">password</code> did not match the one assigned to the user account.
</p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Testing password for user <code class="subtle">5356772</code></summary>
  <pre><code>http://localhost:8080/api/users/password/check?id=5356772&password=b662ae3abc798cf627f31727cf1ea4e0a709f531b49cdfa8a07ac473e2cc91ba</code></pre>
</details>

<h3 id="password--change" class="auth"><code>/password/change</code> - Change a user's password</h3>
<p>This is a <code class="subtle">PUT</code> method.</p>
<h4>Parameters:</h4>
<p><code>id</code> - The ID for the user.</p>
<p>
  <code>newPassword</code> - The new password be set for the user. Should be
  <a href="#required-fields--password">SHA-256 hashed</a>
  before being put into the query.
</p>
<h4>Return values:</h4>
<p><code class="subtle">200: OK</code> - Message: <code class="subtle">"Password changed"</code></p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Changing password for user <code class="subtle">5356772</code></summary>
  <pre><code>http://localhost:8080/api/users/password/change?id=5356772&password=404cdd7bc109c432f8cc2443b45bcfe95980f5107215c645236e577929ac3e52</code></pre>
</details>

<h2>Session functions</h2>
<h3 id="session--create"><code>/session/create</code> - Create a new login session</h3>
<p>This is a <code class="subtle">GET</code> method.</p>
<p class="message note">
  This method, if successful, will also set the <code class="subtle">session_token</code> and
  <code class="subtle">user_id</code> cookies, which are used for
  <a href="#authorization">authorization</a>.
</p>
<h4>Parameters:</h4>
<p><code>iden</code> - The identifier for the user, typically their ID.</p>
<p>
  <code>password</code> - The password to use for login. Should be
  <a href="#required-fields--password">SHA-256 hashed</a>
  before being put into the query.
</p>
<p>
  <code>idenForm</code> - <i>(optional - default <code class="subtle">email</code>)</i> The form of
  the identifier. Valid values are: <code class="subtle">id</code>,
  <code class="subtle">email</code>. Email is used as the default option, since it is most likely to
  be used during login.
</p>
<p>
  <code>expiresInHours</code> - <i>(optional - default <code class="subtle">1</code>)</i> How many
  hours the session token will be valid for. Recommended to be kept at default.
</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - JSON data containing <code class="subtle">token</code>,
  <code class="subtle">userID</code>, and <code class="subtle">expiry</code>.
</p>
<p>
  <code class="subtle">403: FORBIDDEN</code> - The submitted
  <code class="subtle">password</code> did not match the one assigned to the user account.
</p>
<p>
  <code class="subtle">404: NOT FOUND</code> - The <code class="subtle">id</code> did not match any
  users.
</p>
<h4>Examples:</h4>
<details>
  <summary>Creating new session using email</summary>
  <pre><code>http://localhost:8080/api/users/session/create?iden=marko%40em.co&password=404cdd7bc109c432f8cc2443b45bcfe95980f5107215c645236e577929ac3e52</code></pre>
</details>
<details>
  <summary>Creating new session using ID</summary>
  <pre><code>http://localhost:8080/api/users/session/create?iden=5356772&idenForm=id&password=404cdd7bc109c432f8cc2443b45bcfe95980f5107215c645236e577929ac3e52</code></pre>
</details>

<h3 id="session--check" class="auth">
  <code>/session/check</code> - Check the validity of a token
</h3>
<p>This is a <code class="subtle">GET</code> method.</p>
<p>
  This method is largely unused, as requests that require authorization will check the provided
  cookie token on each request.
</p>
<p class="message note">
  If determined that the token is invalid, this method will expire the
  <code class="subtle">session_token</code> and <code class="subtle">user_id</code> cookies.
</p>
<h4>Parameters:</h4>
<p>
  <code>token</code> - <i>(optional)</i> The token to check the validity of. If one is not provided,
  the token is implied from the cookie of the requester.
</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - JSON data containing
  <code class="subtle">message: "Token valid"</code> and <code class="subtle">userID</code>.
</p>
<p>
  <code class="subtle">400: BAD REQUEST</code> - Both the <code class="subtle">token</code> provided
  <b>and</b> the token stored in cookies was missing or blank.
</p>
<p>
  <code class="subtle">410: GONE</code> - The submitted <code class="subtle">token</code> is expired
  or invalid.
</p>
<h4>Examples:</h4>
<details>
  <summary>Checking current session token</summary>
  <pre><code>http://localhost:8080/api/users/session/check</code></pre>
</details>
<details>
  <summary>Checking session token manually</summary>
  <pre><code>http://localhost:8080/api/users/session/check?token=824b7d6493e0f979c69ffa144b14da2e9ae640c47dafd013b173d0515659fb35</code></pre>
</details>

<h3 id="session--expire" class="auth"><code>/session/expire</code> - Forcibly expire a token</h3>
<p>This is a <code class="subtle">DELETE</code> method.</p>
<p class="message note">
  If the token exists, this method will expire the
  <code class="subtle">session_token</code> and <code class="subtle">user_id</code> cookies.
</p>
<h4>Parameters:</h4>
<p>
  <code>token</code> - <i>(optional)</i> The token to expire. If one is not provided, the token is
  implied from the cookie of the requester.
</p>
<h4>Return values:</h4>
<p>
  <code class="subtle">200: OK</code> - Message:
  <code class="subtle">"Token deleted if exists"</code>
</p>
<p>
  <code class="subtle">400: BAD REQUEST</code> - Both the <code class="subtle">token</code> provided
  <b>and</b> the token stored in cookies was missing or blank.
</p>
<details>
  <summary>Expiring current session token</summary>
  <pre><code>http://localhost:8080/api/users/session/expire</code></pre>
</details>
<details>
  <summary>Expiring session token manually</summary>
  <pre><code>http://localhost:8080/api/users/session/expire?token=824b7d6493e0f979c69ffa144b14da2e9ae640c47dafd013b173d0515659fb35</code></pre>
</details>

<br /><br />
